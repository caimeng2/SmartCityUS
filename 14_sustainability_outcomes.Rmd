---
title: "sustainability outcomes"
author: "cm"
date: "2024-04-05"
output: html_document
---

```{r}
library(tidyverse)
library(ggpubr)
```
```{r}
acs <- read.csv("data/acs20240404.csv")
target <- read.csv("data/selected_targets20240214.csv")
smart <- acs %>% filter(smart==1) # only smart cities
```

```{r}
smart <- merge(smart, target, by = "GISJOIN", all.x = TRUE)
smart[is.na(smart)] <- 0
```
```{r}
head(smart)
```
```{r}
sdg1_1 <- acs %>% group_by(smart) %>% summarise(mean = mean(poverty, na.rm=T), 
                                                n = n(),
                                                lowerint = t.test(poverty)$conf.int[1], 
                                                upperint = t.test(poverty)$conf.int[2])
```
```{r}
sdg1_1
```

```{r}
# # manual calculation just to double check
# n <- length(smart$poverty)
# xbar <- mean(smart$poverty, na.rm=T)
# s <- sd(smart$poverty, na.rm = T)
# margin <- qt(0.975,df=n-1)*s/sqrt(n) #margin of error, 95% confidence interval 
# lowerinterval <- xbar - margin
# upperinterval <- xbar + margin
# print(lowerinterval)
# print(upperinterval)
```
```{r}
mycolor <- c("#596174","#ea6a47" )
```

```{r}
ggplot(sdg1_1,aes(x = as.factor(smart), y = mean, color = as.factor(smart))) + 
  geom_errorbar(aes(ymin = lowerint, ymax = upperint), width=.02) + 
  scale_x_discrete(name =" ", labels = c("1"="Smart cities", "0"="Non-smart cities")) +
  geom_point() +
  ylim(10,16) +
  ylab("Poverty rate (%)") +
  scale_color_manual(values = mycolor, name=" ", labels=c("1"="Smart cities", "0"="Non-smart cities")) +
  theme_classic()
```
```{r}
a <- ggplot(sdg1_1,aes(x = as.factor(smart), y = mean, color = as.factor(smart))) + 
  geom_errorbar(aes(ymin = lowerint, ymax = upperint), width=.1) + 
  scale_x_discrete(name =" ", labels = c("1"="Smart cities", "0"="Non-smart cities")) +
  geom_point() +
  ylim(9,18) +
  ylab("Poverty rate (%)") +
  scale_color_manual(values = mycolor, guide="none") +
  theme_classic() +
  theme(plot.margin = unit(c(0,0.1,0,0), 'lines'))
a
```

```{r}
sdg1_1s <- smart %>% group_by(SDG1_1) %>% summarise(mean = mean(poverty, na.rm=T), 
                                                n = n(),
                                                lowerint = t.test(poverty)$conf.int[1], 
                                                upperint = t.test(poverty)$conf.int[2])
b <- ggplot(sdg1_1s,aes(x = as.factor(SDG1_1), y = mean)) + 
  geom_errorbar(aes(ymin = lowerint, ymax = upperint), color = "#ea6a47", width=.1) + 
  scale_x_discrete(name =" ", labels = c("1"="With policy", "0"="Without policy")) +
  geom_point(color = "#ea6a47") +
  ylim(9,18) +
  ylab("") +
  theme_classic()+
  theme(plot.margin = unit(c(0,0.1,0,0), 'lines'))
b
```
```{r}
sdg1_1p <- acs %>% group_by(pop_size, smart) %>% summarise(mean = mean(poverty, na.rm=T), 
                                                n = n(),
                                                lowerint = t.test(poverty)$conf.int[1], 
                                                upperint = t.test(poverty)$conf.int[2])
c <- ggplot(sdg1_1p, aes(x = factor(pop_size, level=c("4", "3", "2", "1")), y = mean, color = as.factor(smart))) + 
  geom_errorbar(aes(ymin = lowerint, ymax = upperint), position = position_dodge(width=.5), width=.1) + 
  scale_x_discrete(name ="Population", labels = c("1"="less than 10,000", "2"="10,000 to 99,999", "3"="100,000 to 999,999", "4"="1 million or more")) +
  geom_point(position = position_dodge(width=.5)) +
  ylab("") +
  scale_color_manual(values = mycolor, guide="none") +
  theme_classic()+
  theme(plot.margin = unit(c(0,0.1,0,0), 'lines'))

c
```

```{r}
ggarrange(a, b, c, ncol = 3, nrow = 1, widths = c(1, 1, 2) )
```

